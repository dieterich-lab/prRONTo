## Results {.tabset}

### Summary

<h3>Overlap of outliers</h3>

|               |                         |                         |                          |
| ------------- | ----------------------- | ----------------------- | ------------------------ |
| n = neighbors | c = contamination (lof) | s = seed (downsampling) | r = reads (downsampling) |


{% for lof in config["lof"] %}
<h5> LOF: neighbors~{{lof["neighbors"]}}, contamination~{{lof["contamination"]}} </h5>
```{r, fig-feature-overlap-{{lof["neighbors"]}}-{{lof["contamination"]}})}
readRDS("../plots/original/feature_summary/neighbors~{{lof['neighbors']}}_contamination~{{lof['contamination']}}.rds") %>%
  print()
```
{% endfor %}

<h3>Density for features (preprocessed)</h3>

```{r, fig-feature-lof-summary}
readRDS("../plots/feature_lof_summary.rds") %>%
  print()
```


|                    |                    |                     |
| ------------------ | ------------------ | ------------------- |
| M = Mismatch score | D = Deletion score | I = Insertion score |

{% for region in PRONTO["regions"] %}
{% if loop.first %}
### Region: {{region}} {.tabset}
{% else %}
### {{region}} {.tabset}
{% endif %}
{% for feature in config["jacusa2"]["features"] %}
{% if loop.first %}
#### Feature: {{feature}} {.tabset}
{% else %}
#### {{feature}} {.tabset}
{% endif%}
{% for lof in config["lof"] %}
{% if loop.first %}
##### *LOF: neighbors~{{lof["neighbors"]}}, contamination~{{lof["contamination"]}}*
{% else %}
##### *.~{{lof["neighbors"]}}, .~{{lof["contamination"]}}*
{% endif %}
{% if config["downsampling"] %}
```{r, fig-read-{{lof["neighbors"]}}-{{lof["contamination"]}}-{{feature}}-{{region}}-summary, fig.align="center"}
readRDS("../plots/downsampling_summary/neighbors~{{lof["neighbors"]}}_contamination~{{lof["contamination"]}}/feature~{{feature}}/{{region}}.rds") %>%
  print()
```
{% endif %}

<h3>Preprocessed</h3>
```{r, fig-feature-analysis-preprocessed-{{lof["neighbors"]}}-{{lof["contamination"]}}-{{feature}}-{{region}}-barplot, fig.align="center"}
readRDS("../plots/feature/original/preprocessed/neighbors~{{lof["neighbors"]}}_contamination~{{lof["contamination"]}}/feature~{{feature}}/{{region}}_barplot.rds") %>%
  print()
```

<!-- TODO: add is target -->

```{r, fig-feature-analysis-preprocessed-{{lof["neighbors"]}}-{{lof["contamination"]}}-{{feature}}-{{region}}-table, results="asis", fig.align="center"}
read.table("../plots/feature/original/preprocessed/neighbors~{{lof["neighbors"]}}_contamination~{{lof["contamination"]}}/feature~{{feature}}/{{region}}_outlier.tsv", header = TRUE, sep = "\t") %>%
  dplyr::select(seqnames, pos, ref, ref_context, mod, outlier_type, is_in_neighborhood) %>%
  dplyr::rename("seq. id" = "seqnames", "ref." = "ref", "ref. context" = "ref_context", "outlier type" = "outlier_type", "mods in vicinity" = "is_in_neighborhood") %>%
  dplyr::mutate(mod = dplyr::recode(mod, "*" = "")) %>%
  knitr::kable() %>%
  kableExtra::kable_styling(full_width = FALSE)
```
{% if config["downsampling"] %}
{% for reads in config["downsampling"]["reads"] %}
{% for seed in config["downsampling"]["seed"] %}
<h3>Sampling: Reads~{{reads}} Seed~{{seed}}</h3>

```{r, fig-feature-analysis-{{reads}}-{{seed}}-preprocessed-{{lof["neighbors"]}}-{{lof["contamination"]}}-{{feature}}-{{region}}-barplot, fig.align="center"}
readRDS("../plots/feature/downsampling/seed~{{seed}}_reads~{{reads}}/neighbors~{{lof["neighbors"]}}_contamination~{{lof["contamination"]}}/feature~{{feature}}/{{region}}_barplot.rds") %>%
  print()
```
```{r, fig-feature-downsampling-{{reads}}-{{seed}}-{{lof["neighbors"]}}-{{lof["contamination"]}}-{{feature}}-{{region}}-table, results="asis", fig.align="center"}
read.table("../plots/feature/downsampling/seed~{{seed}}_reads~{{reads}}/neighbors~{{lof["neighbors"]}}_contamination~{{lof["contamination"]}}/feature~{{feature}}/{{region}}_outlier.tsv", header = TRUE, sep = "\t") %>%
  dplyr::select(seqnames, pos, ref, ref_context, mod, outlier_type, is_in_neighborhood) %>%
  dplyr::rename("seq. id" = "seqnames", "ref." = "ref", "ref. context" = "ref_context", "outlier type" = "outlier_type", "mods in vicinity" = is_in_neighborhood) %>%
  dplyr::mutate(mod = dplyr::recode(mod, "*" = "")) %>%
  knitr::kable() %>%
  kableExtra::kable_styling(full_width = FALSE)
```
{% endfor %}
{% endfor %}
{% endif %}
{% endfor %}
{% endfor %}
{% endfor %}

